<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ£€æŸ¥è·¯ç”±é…ç½®</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        h1 { color: #333; }
        button { padding: 12px 24px; background: #4a90e2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #357abd; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #4a90e2; color: white; }
        tr:hover { background: #f5f5f5; }
        .found { color: #27ae60; font-weight: bold; }
        .not-found { color: #e74c3c; font-weight: bold; }
        .methods { color: #3498db; font-family: monospace; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ£€æŸ¥æœåŠ¡å™¨è·¯ç”±é…ç½®</h1>
        <p>è¿™ä¸ªå·¥å…·ä¼šæ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£ç¡®æ³¨å†Œäº†æ‰¹é‡å›æµ‹æ‰€éœ€çš„APIè·¯ç”±</p>
        
        <button onclick="checkRoutes()">ğŸ” æ£€æŸ¥è·¯ç”±é…ç½®</button>
        
        <div id="result"></div>
    </div>

    <script>
        async function checkRoutes() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<p>æ­£åœ¨æ£€æŸ¥...</p>';
            
            try {
                const response = await fetch('http://localhost:5000/api/debug/routes');
                const data = await response.json();
                
                const routes = data.routes;
                
                // æ£€æŸ¥å…³é”®è·¯ç”±
                const crAnalysisRoute = routes.find(r => r.path === '/api/cr_analysis');
                const backtestRoute = routes.find(r => r.path === '/api/backtest');
                
                let html = '<h2>è·¯ç”±æ£€æŸ¥ç»“æœ</h2>';
                
                // æ£€æŸ¥ cr_analysis
                html += '<h3>1. /api/cr_analysis</h3>';
                if (crAnalysisRoute) {
                    html += `<p class="found">âœ… å·²æ‰¾åˆ°</p>`;
                    html += `<p class="methods">æ”¯æŒçš„æ–¹æ³•: ${crAnalysisRoute.methods.join(', ')}</p>`;
                    
                    if (crAnalysisRoute.methods.includes('POST') && crAnalysisRoute.methods.includes('OPTIONS')) {
                        html += '<p class="found">âœ… POSTå’ŒOPTIONSæ–¹æ³•éƒ½å·²é…ç½®</p>';
                    } else if (crAnalysisRoute.methods.includes('POST')) {
                        html += '<p class="not-found">âŒ åªæœ‰POSTï¼Œç¼ºå°‘OPTIONSæ–¹æ³•</p>';
                        html += '<p><strong>è¿™å°±æ˜¯405é”™è¯¯çš„åŸå› ï¼</strong></p>';
                    } else {
                        html += '<p class="not-found">âŒ ç¼ºå°‘POSTæ–¹æ³•</p>';
                    }
                } else {
                    html += '<p class="not-found">âŒ æœªæ‰¾åˆ°æ­¤è·¯ç”±</p>';
                }
                
                // æ£€æŸ¥ backtest
                html += '<h3>2. /api/backtest</h3>';
                if (backtestRoute) {
                    html += `<p class="found">âœ… å·²æ‰¾åˆ°</p>`;
                    html += `<p class="methods">æ”¯æŒçš„æ–¹æ³•: ${backtestRoute.methods.join(', ')}</p>`;
                    
                    if (backtestRoute.methods.includes('POST') && backtestRoute.methods.includes('OPTIONS')) {
                        html += '<p class="found">âœ… POSTå’ŒOPTIONSæ–¹æ³•éƒ½å·²é…ç½®</p>';
                    } else {
                        html += '<p class="not-found">âš ï¸ å¯èƒ½ç¼ºå°‘OPTIONSæ–¹æ³•</p>';
                    }
                } else {
                    html += '<p class="not-found">âŒ æœªæ‰¾åˆ°æ­¤è·¯ç”±</p>';
                }
                
                // æ˜¾ç¤ºæ‰€æœ‰APIè·¯ç”±
                html += '<h3>æ‰€æœ‰APIè·¯ç”±åˆ—è¡¨</h3>';
                html += '<table>';
                html += '<tr><th>è·¯å¾„</th><th>æ–¹æ³•</th><th>ç«¯ç‚¹</th></tr>';
                
                routes
                    .filter(r => r.path.startsWith('/api/'))
                    .sort((a, b) => a.path.localeCompare(b.path))
                    .forEach(route => {
                        const methodsList = route.methods.filter(m => m !== 'HEAD').join(', ');
                        html += `<tr>
                            <td><code>${route.path}</code></td>
                            <td class="methods">${methodsList}</td>
                            <td>${route.endpoint}</td>
                        </tr>`;
                    });
                
                html += '</table>';
                
                // è¯Šæ–­ç»“è®º
                html += '<h2>ğŸ” è¯Šæ–­ç»“è®º</h2>';
                if (crAnalysisRoute && crAnalysisRoute.methods.includes('POST') && crAnalysisRoute.methods.includes('OPTIONS')) {
                    html += '<div style="background: #d4edda; padding: 20px; border-radius: 8px; border-left: 5px solid #28a745;">';
                    html += '<p class="found">âœ… è·¯ç”±é…ç½®æ­£ç¡®ï¼</p>';
                    html += '<p>å¦‚æœä»ç„¶å‡ºç°405é”™è¯¯ï¼Œè¯·ï¼š</p>';
                    html += '<ol>';
                    html += '<li>æ¸…é™¤æµè§ˆå™¨ç¼“å­˜ï¼ˆCtrl+Shift+Deleteï¼‰</li>';
                    html += '<li>ä½¿ç”¨æ— ç—•æ¨¡å¼é‡è¯•</li>';
                    html += '<li>æ£€æŸ¥æ˜¯å¦æœ‰ä»£ç†æˆ–VPNå¹²æ‰°</li>';
                    html += '</ol>';
                    html += '</div>';
                } else {
                    html += '<div style="background: #f8d7da; padding: 20px; border-radius: 8px; border-left: 5px solid #dc3545;">';
                    html += '<p class="not-found">âŒ è·¯ç”±é…ç½®æœ‰é—®é¢˜</p>';
                    html += '<p><strong>é—®é¢˜åŸå› ï¼š</strong></p>';
                    if (!crAnalysisRoute) {
                        html += '<p>â€¢ /api/cr_analysis è·¯ç”±æœªæ³¨å†Œ</p>';
                    } else if (!crAnalysisRoute.methods.includes('OPTIONS')) {
                        html += '<p>â€¢ /api/cr_analysis ç¼ºå°‘OPTIONSæ–¹æ³•æ”¯æŒ</p>';
                    }
                    html += '<p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p>';
                    html += '<ol>';
                    html += '<li><strong style="color: red;">ç¡®è®¤backend/app.pyæ–‡ä»¶å·²ä¿å­˜</strong></li>';
                    html += '<li>å®Œå…¨å…³é—­åç«¯æœåŠ¡ï¼ˆåœ¨å‘½ä»¤è¡Œçª—å£æŒ‰Ctrl+Cï¼‰</li>';
                    html += '<li>é‡æ–°è¿è¡Œ start.bat</li>';
                    html += '<li>ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆçœ‹åˆ°"Running on..."ï¼‰</li>';
                    html += '<li>é‡æ–°åŠ è½½æœ¬é¡µé¢æ£€æŸ¥</li>';
                    html += '</ol>';
                    html += '</div>';
                }
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div style="background: #f8d7da; padding: 20px; border-radius: 8px;">
                        <h2 class="not-found">âŒ æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨</h2>
                        <p>é”™è¯¯: ${error.message}</p>
                        <p><strong>è¯·ç¡®è®¤ï¼š</strong></p>
                        <ol>
                            <li>åç«¯æœåŠ¡æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Ÿ</li>
                            <li>æ˜¯å¦è¿è¡Œäº† start.batï¼Ÿ</li>
                            <li>ç«¯å£5000æ˜¯å¦è¢«å…¶ä»–ç¨‹åºå ç”¨ï¼Ÿ</li>
                        </ol>
                    </div>
                `;
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æ£€æŸ¥
        window.addEventListener('DOMContentLoaded', checkRoutes);
    </script>
</body>
</html>

