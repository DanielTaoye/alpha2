<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>è°ƒè¯•æ‰¹é‡å›æµ‹æ•°æ®</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        button { padding: 12px 24px; margin: 10px 5px; background: #4a90e2; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #357abd; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        h3 { color: #333; margin-top: 0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” è°ƒè¯•æ‰¹é‡å›æµ‹æ•°æ®ç»“æ„</h1>
        
        <button onclick="debugData()">å¼€å§‹è°ƒè¯•</button>
        
        <div id="output"></div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:5000/api';
        
        async function debugData() {
            const output = document.getElementById('output');
            output.innerHTML = '<p>æ­£åœ¨è°ƒè¯•...</p>';
            
            let html = '';
            
            try {
                // 1. è·å–è‚¡ç¥¨åˆ—è¡¨
                html += '<div class="section"><h3>æ­¥éª¤1: è·å–è‚¡ç¥¨åˆ—è¡¨</h3>';
                const response = await fetch(API_BASE_URL + '/stock_groups');
                const data = await response.json();
                
                html += '<p><strong>APIè¿”å›çš„å®Œæ•´æ•°æ®ï¼š</strong></p>';
                html += '<pre>' + JSON.stringify(data, null, 2) + '</pre>';
                
                if (data.code === 200 && data.data) {
                    const strategies = Object.keys(data.data);
                    const firstStrategy = strategies[0];
                    const stocks = data.data[firstStrategy];
                    const firstStock = stocks[0];
                    
                    html += '<p><strong>ç¬¬ä¸€ä¸ªç­–ç•¥ï¼š</strong>' + firstStrategy + '</p>';
                    html += '<p><strong>ç¬¬ä¸€æ”¯è‚¡ç¥¨çš„æ•°æ®ï¼š</strong></p>';
                    html += '<pre>' + JSON.stringify(firstStock, null, 2) + '</pre>';
                    
                    html += '<p><strong>æ£€æŸ¥å­—æ®µï¼š</strong></p>';
                    html += '<ul>';
                    html += '<li>firstStock.code = ' + (firstStock.code || 'âŒ ä¸å­˜åœ¨') + '</li>';
                    html += '<li>firstStock.name = ' + (firstStock.name || 'âŒ ä¸å­˜åœ¨') + '</li>';
                    html += '<li>firstStock.table = ' + (firstStock.table || 'âŒ ä¸å­˜åœ¨') + '</li>';
                    html += '<li>firstStock.table_name = ' + (firstStock.table_name || 'âŒ ä¸å­˜åœ¨') + '</li>';
                    html += '</ul>';
                    
                    html += '</div>';
                    
                    // 2. æµ‹è¯•CRåˆ†æ
                    html += '<div class="section"><h3>æ­¥éª¤2: æµ‹è¯•CRåˆ†æ</h3>';
                    html += '<p>æµ‹è¯•è‚¡ç¥¨: ' + firstStock.name + ' (' + firstStock.code + ')</p>';
                    
                    const crRequestBody = {
                        stockCode: firstStock.code,
                        stockName: firstStock.name,
                        tableName: firstStock.table_name,
                        period: 'day'
                    };
                    
                    html += '<p><strong>CRåˆ†æè¯·æ±‚å‚æ•°ï¼š</strong></p>';
                    html += '<pre>' + JSON.stringify(crRequestBody, null, 2) + '</pre>';
                    
                    const crResponse = await fetch(API_BASE_URL + '/cr_analysis', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(crRequestBody)
                    });
                    
                    const crData = await crResponse.json();
                    
                    html += '<p><strong>CRåˆ†æå“åº”çŠ¶æ€ï¼š</strong>' + crResponse.status + '</p>';
                    html += '<p><strong>CRåˆ†æå“åº”æ•°æ®ï¼š</strong></p>';
                    html += '<pre>' + JSON.stringify(crData, null, 2).substring(0, 1000) + '...</pre>';
                    
                    html += '</div>';
                    
                    // 3. æ¨¡æ‹Ÿæ‰¹é‡å›æµ‹ç»“æœæ•°æ®ç»“æ„
                    html += '<div class="section"><h3>æ­¥éª¤3: æ¨¡æ‹Ÿç»“æœå¯¹è±¡</h3>';
                    
                    const mockResult = {
                        stock: firstStock,
                        success: true,
                        data: {
                            summary: {
                                total_trades: 5,
                                total_return: 25.5,
                                avg_return: 5.1,
                                win_rate: 60,
                                max_return: 15.2,
                                min_return: -3.5
                            }
                        }
                    };
                    
                    html += '<p><strong>æ¨¡æ‹Ÿçš„ç»“æœå¯¹è±¡ï¼š</strong></p>';
                    html += '<pre>' + JSON.stringify(mockResult, null, 2) + '</pre>';
                    
                    html += '<p><strong>è®¿é—®å­—æ®µæµ‹è¯•ï¼š</strong></p>';
                    html += '<ul>';
                    html += '<li>result.stock.code = ' + (mockResult.stock.code || 'âŒ undefined') + '</li>';
                    html += '<li>result.stock.name = ' + (mockResult.stock.name || 'âŒ undefined') + '</li>';
                    html += '<li>result.stock.table_name = ' + (mockResult.stock.table_name || 'âŒ undefined') + '</li>';
                    html += '</ul>';
                    
                    html += '<p><strong>ç”Ÿæˆè¡¨æ ¼HTMLæµ‹è¯•ï¼š</strong></p>';
                    const summary = mockResult.data.summary;
                    const testRow = `
                        <td>1</td>
                        <td>${mockResult.stock.code}</td>
                        <td>${mockResult.stock.name}</td>
                        <td>${summary.total_trades}</td>
                        <td>${summary.total_return.toFixed(2)}%</td>
                        <td>${summary.avg_return.toFixed(2)}%</td>
                        <td>${summary.win_rate.toFixed(2)}%</td>
                        <td>${summary.max_return.toFixed(2)}%</td>
                        <td>${summary.min_return.toFixed(2)}%</td>
                        <td>âœ“ æˆåŠŸ</td>
                    `;
                    
                    html += '<p>ç”Ÿæˆçš„è¡¨æ ¼è¡ŒHTMLï¼š</p>';
                    html += '<pre>' + testRow + '</pre>';
                    
                    html += '<p><strong>å®é™…æ¸²æŸ“æ•ˆæœï¼š</strong></p>';
                    html += '<table border="1" cellpadding="10">';
                    html += '<tr><th>åºå·</th><th>è‚¡ç¥¨ä»£ç </th><th>è‚¡ç¥¨åç§°</th><th>äº¤æ˜“æ¬¡æ•°</th><th>æ€»æ”¶ç›Šç‡</th><th>å¹³å‡æ”¶ç›Šç‡</th><th>èƒœç‡</th><th>æœ€å¤§æ”¶ç›Š</th><th>æœ€å¤§äºæŸ</th><th>çŠ¶æ€</th></tr>';
                    html += '<tr>' + testRow + '</tr>';
                    html += '</table>';
                    
                    html += '</div>';
                }
                
                output.innerHTML = html;
                
            } catch (error) {
                output.innerHTML = '<div class="section"><h3>âŒ é”™è¯¯</h3><p>' + error.message + '</p><pre>' + error.stack + '</pre></div>';
            }
        }
    </script>
</body>
</html>

