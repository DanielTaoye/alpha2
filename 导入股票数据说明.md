# 股票数据导入说明

## 📋 功能概述

本工具用于从生产环境（腾讯云数据库）拉取股票数据并导入到本地数据库，同时更新应用配置。

### 主要功能

- ✅ 从生产环境拉取45支股票的基本信息
- ✅ 从生产环境拉取45支股票的K线数据（30分钟、日线、周线、月线）
- ✅ 将数据导入到本地MySQL数据库
- ✅ 自动创建不存在的数据表
- ✅ 更新 `backend/app.py` 配置文件
- ✅ 将每个股性分组从5支扩展到20支

## 📦 股票清单

### 波段策略（20支）
1. 国投智能 SZ300188
2. 海兴电力 SH603556
3. 沃尔核材 SZ002130
4. 歌华有线 SH600037
5. 中集车辆 SZ301039
6. 蓝色光标 SZ300058
7. 迪普科技 SZ300768
8. 思瑞浦 SH688536
9. 时代新材 SH600458
10. 东华软件 SZ002065
11. 福蓉科技 SH603327
12. 筑博设计 SZ300564
13. 杭叉集团 SH603298
14. 维信诺 SZ002387
15. 康美药业 SH600518
16. 广汇能源 SH600256
17. 科沃斯 SH603486
18. 高能环境 SH603588
19. 北新建材 SZ000786
20. 安通控股 SH600179

### 短线策略（20支）
1. 白云机场 SH600004
2. 金雷股份 SZ300443
3. 南京化纤 SH600889
4. 慧智微-U SH688512
5. 锴威特 SH688693
6. 新疆天业 SH600075
7. 物产金轮 SZ002722
8. 中巨芯-U SH688549
9. 美湖股份 SH603319
10. 依米康 SZ300249
11. 中化装备 SH600579
12. 科锐国际 SZ300662
13. 三晖电气 SZ002857
14. 易尚退 SZ002751
15. 长青科技 SZ001324
16. 菲菱科思 SZ301191
17. 运达股份 SZ300772
18. 上纬新材 SH688585
19. 开创电气 SZ301448
20. 康希通信 SH688653

### 中长线策略（20支）
1. 立讯精密 SZ002475
2. 宁德时代 SZ300750
3. 农业银行 SH601288
4. 中国石油 SH601857
5. 紫金矿业 SH601899
6. 传音控股 SH688036
7. 常熟银行 SH601128
8. 潍柴动力 SZ000338
9. 海螺水泥 SH600585
10. 民生银行 SH600016
11. 华域汽车 SH600741
12. 申万宏源 SZ000166
13. 陕西煤业 SH601225
14. 泸州老窖 SZ000568
15. 江阴银行 SZ002807
16. 中微公司 SH688012
17. 春秋航空 SH601021
18. 光启技术 SZ002625
19. 宇通客车 SH600066
20. 中远海控 SH601919

## 🚀 快速开始

### 方式一：一键执行（推荐）

```bash
python import_and_update.py
```

这个脚本会：
1. 提示确认操作
2. 自动导入所有股票数据
3. 自动更新应用配置
4. 显示执行结果和下一步操作

### 方式二：分步执行

#### 步骤1：导入股票数据

```bash
python import_stocks_from_prod.py
```

这个脚本会：
- 连接生产环境数据库（腾讯云）
- 连接本地数据库
- 导入45支股票的基本信息到 `basic_stock` 表
- 导入45支股票的K线数据到各自的表（如 `basic_data_sz300188`）

#### 步骤2：更新应用配置

```bash
python update_app_config.py
```

这个脚本会：
- 备份 `backend/app.py` 为 `backend/app.py.backup`
- 更新 `STOCK_GROUPS` 配置
- 将每个股性分组从5支扩展到20支

## ⚙️ 配置说明

### 生产环境数据库配置

在 `import_stocks_from_prod.py` 中：

```python
PROD_DB_CONFIG = {
    'host': 'sh-cdb-2hxu41ka.sql.tencentcdb.com',
    'port': 21648,
    'user': 'root',
    'password': 'MrEPYZus7myr',
    'database': 'stock',
    'charset': 'utf8mb4'
}
```

### 本地数据库配置

在 `import_stocks_from_prod.py` 中：

```python
LOCAL_DB_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': '1234',
    'database': 'stock',
    'charset': 'utf8mb4'
}
```

**注意**：请根据实际情况修改本地数据库密码。

## 📊 数据表结构

### basic_stock 表

存储股票基本信息，包括：
- 股票代码、名称
- 市值、营收
- 股性（短线、波段、中长线）
- 行业信息
- 评分数据

### K线数据表

每支股票一张表，命名格式：`basic_data_{股票代码小写}`

例如：
- `basic_data_sz300188` (国投智能)
- `basic_data_sh600004` (白云机场)

包含字段：
- `shi_jian`: 时间
- `kai_pan_jia`: 开盘价
- `zui_gao_jia`: 最高价
- `zui_di_jia`: 最低价
- `shou_pan_jia`: 收盘价
- `cheng_jiao_liang`: 成交量
- `liang_bi`: 量比
- `wei_bi`: 委比
- `peroid_type`: 周期类型（4-30分钟, 6-日线, 7-周线, 8-月线）

## 🔧 使用前提

### 环境要求

- Python 3.6+
- MySQL 数据库
- pymysql 库

### 网络要求

- 能够访问腾讯云数据库
- 本机IP已添加到腾讯云数据库白名单

### 数据库要求

- 本地MySQL数据库已安装并运行
- 已创建 `stock` 数据库
- 数据库用户有足够权限

## 📝 使用步骤

### 1. 检查配置

确认配置文件中的数据库信息正确：

```bash
# 测试本地数据库连接
python test_local_db.py

# 测试生产环境数据库连接
python test_db.py
```

### 2. 执行导入

```bash
# 方式1：一键执行
python import_and_update.py

# 方式2：分步执行
python import_stocks_from_prod.py
python update_app_config.py
```

### 3. 验证数据

```bash
# 检查数据库
python database_check.py

# 或者直接连接MySQL查询
mysql -u root -p stock
> SELECT COUNT(*) FROM basic_stock WHERE nature='短线';
> SELECT COUNT(*) FROM basic_data_sz300188;
```

### 4. 重启应用

```bash
# Windows
start.bat

# Linux/Mac
./start.sh

# 或手动启动
cd backend
python app.py
```

### 5. 访问系统

浏览器打开：`http://localhost:5000`

在页面中：
- 选择不同的股性分组（波段、短线、中长线）
- 应该能看到20支股票
- 选择股票查看K线图

## ⚠️ 注意事项

### 1. 数据安全

- 脚本会自动备份 `backend/app.py` 为 `backend/app.py.backup`
- 导入前会检查数据是否已存在，避免重复导入
- 建议在导入前备份本地数据库

### 2. 网络问题

- 确保能连接到腾讯云数据库
- 如果连接超时，检查网络和IP白名单
- 大量数据导入可能需要较长时间，请耐心等待

### 3. 数据冲突

- 如果 `basic_stock` 表中已存在相同股票代码，会跳过导入
- 如果K线数据表已有数据，会跳过导入
- 如需重新导入，请先手动删除相关数据

### 4. 配置更新

- 更新配置前会自动备份原文件
- 如果更新失败，可以从备份文件恢复
- 恢复命令：`copy backend\app.py.backup backend\app.py`

## 🐛 故障排除

### 问题1：无法连接生产环境数据库

**错误信息**：`OperationalError: (2003, "Can't connect to MySQL server...")`

**解决方案**：
1. 检查网络连接
2. 确认腾讯云数据库实例正在运行
3. 在腾讯云控制台添加本机IP到白名单
4. 检查防火墙设置

### 问题2：无法连接本地数据库

**错误信息**：`Access denied for user 'root'@'localhost'`

**解决方案**：
1. 确认本地MySQL正在运行
2. 检查用户名和密码是否正确
3. 修改 `import_stocks_from_prod.py` 中的 `LOCAL_DB_CONFIG`

### 问题3：表不存在

**错误信息**：`Table 'stock.basic_stock' doesn't exist`

**解决方案**：
1. 确认本地数据库中有 `basic_stock` 表
2. 可以从 `stock_export/basic_stock.sql` 导入表结构
3. 运行：`mysql -u root -p stock < stock_export/basic_stock.sql`

### 问题4：导入数据很慢

**原因**：K线数据量大，批量导入需要时间

**解决方案**：
- 这是正常现象，请耐心等待
- 可以修改 `import_stocks_from_prod.py` 中的 `batch_size` 参数提高批量大小
- 建议在网络良好的环境下执行

### 问题5：配置更新失败

**错误信息**：`未找到 STOCK_GROUPS 配置`

**解决方案**：
1. 检查 `backend/app.py` 文件是否存在
2. 检查文件格式是否被修改
3. 从备份文件恢复后重试

## 📞 获取帮助

如果遇到问题：

1. 查看脚本输出的错误信息
2. 检查日志文件
3. 参考本文档的故障排除部分
4. 查看项目其他文档：
   - `数据库配置说明.txt`
   - `QUICKSTART.md`
   - `USAGE.md`

## 📄 相关文件

- `import_stocks_from_prod.py` - 数据导入脚本
- `update_app_config.py` - 配置更新脚本
- `import_and_update.py` - 一键执行脚本
- `backend/app.py` - 应用主文件
- `config.py` - 配置文件

## ✅ 检查清单

导入完成后，检查以下内容：

- [ ] 本地数据库 `basic_stock` 表中有45条新股票记录
- [ ] 本地数据库中有45张K线数据表
- [ ] 每张K线数据表都有数据
- [ ] `backend/app.py` 中 `STOCK_GROUPS` 每组有20支股票
- [ ] `backend/app.py.backup` 备份文件存在
- [ ] 应用能正常启动
- [ ] 网页能正常显示所有股票
- [ ] K线图能正常加载

## 🎉 完成

导入完成后，你的系统将拥有：

- ✅ 45支股票的完整数据
- ✅ 每个股性分组20支股票
- ✅ 完整的历史K线数据
- ✅ 更新的应用配置

现在可以开始使用完整的股票分析系统了！

