# å¿«é€Ÿå¼€å§‹æŒ‡å— - DDDæ¶æ„ç‰ˆæœ¬

## ğŸ¯ é¡¹ç›®å·²å®ŒæˆDDDæ¶æ„é‡æ„

æ‚¨çš„Pythoné¡¹ç›®å·²æˆåŠŸé‡æ„ä¸ºæ ‡å‡†çš„4å±‚DDDï¼ˆé¢†åŸŸé©±åŠ¨è®¾è®¡ï¼‰æ¶æ„ï¼š

1. **ç”¨æˆ·æ¥å£å±‚**ï¼ˆinterfacesï¼‰- å¤„ç†APIè¯·æ±‚
2. **åº”ç”¨å±‚**ï¼ˆapplicationï¼‰- ä¸šåŠ¡æµç¨‹ç¼–æ’
3. **é¢†åŸŸå±‚**ï¼ˆdomainï¼‰- æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
4. **åŸºç¡€è®¾æ–½å±‚**ï¼ˆinfrastructureï¼‰- æŠ€æœ¯å®ç°

å‰ç«¯æ–‡ä»¶ä¹Ÿå·²åˆ†ç¦»ä¸ºHTMLã€CSSã€JSä¸‰ä¸ªç‹¬ç«‹æ–‡ä»¶ã€‚

## ğŸš€ å¯åŠ¨æ­¥éª¤

### 1. æ£€æŸ¥Pythonç¯å¢ƒ

ç¡®ä¿å·²å®‰è£…æ‰€éœ€ä¾èµ–ï¼š
```bash
pip install -r requirements.txt
```

ä¸»è¦ä¾èµ–ï¼š
- Flask
- Flask-CORS
- PyMySQL
- Requests

### 2. é…ç½®æ•°æ®åº“

ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š`backend/infrastructure/config/database_config.py`

```python
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'root',
    'password': 'ä½ çš„å¯†ç ',
    'database': 'stock',
    'charset': 'utf8mb4'
}
```

### 3. å¯åŠ¨åº”ç”¨

#### Windows
```bash
start.bat
```

#### Linux/Mac
```bash
./start.sh
```

#### æˆ–æ‰‹åŠ¨å¯åŠ¨
```bash
cd backend
python app.py
```

### 4. è®¿é—®ç³»ç»Ÿ

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š
```
http://localhost:5000
```

## ğŸ“‚ é¡¹ç›®ç»“æ„è¯´æ˜

### åç«¯æ¶æ„

```
backend/
â”œâ”€â”€ interfaces/              # ğŸŒ ç”¨æˆ·æ¥å£å±‚
â”‚   â”œâ”€â”€ controllers/         # APIæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ stock_controller.py
â”‚   â”‚   â”œâ”€â”€ kline_controller.py
â”‚   â”‚   â””â”€â”€ analysis_controller.py
â”‚   â””â”€â”€ dto/
â”‚       â””â”€â”€ response.py      # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚
â”œâ”€â”€ application/             # ğŸ”„ åº”ç”¨å±‚
â”‚   â””â”€â”€ services/            # åº”ç”¨æœåŠ¡
â”‚       â”œâ”€â”€ stock_service.py
â”‚       â”œâ”€â”€ kline_service.py
â”‚       â””â”€â”€ analysis_service.py
â”‚
â”œâ”€â”€ domain/                  # ğŸ’ é¢†åŸŸå±‚ï¼ˆæ ¸å¿ƒï¼‰
â”‚   â”œâ”€â”€ models/              # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ stock.py         # è‚¡ç¥¨å®ä½“
â”‚   â”‚   â””â”€â”€ kline.py         # Kçº¿å®ä½“
â”‚   â”œâ”€â”€ repositories/        # ä»“å‚¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ kline_repository.py
â”‚   â”‚   â””â”€â”€ stock_analysis_repository.py
â”‚   â””â”€â”€ services/            # é¢†åŸŸæœåŠ¡
â”‚       â””â”€â”€ period_service.py
â”‚
â””â”€â”€ infrastructure/          # ğŸ› ï¸ åŸºç¡€è®¾æ–½å±‚
    â”œâ”€â”€ persistence/         # æ•°æ®æŒä¹…åŒ–
    â”‚   â”œâ”€â”€ database.py
    â”‚   â””â”€â”€ kline_repository_impl.py
    â”œâ”€â”€ external_apis/       # å¤–éƒ¨API
    â”‚   â”œâ”€â”€ stock_analysis_api.py
    â”‚   â””â”€â”€ stock_analysis_repository_impl.py
    â””â”€â”€ config/              # é…ç½®
        â”œâ”€â”€ database_config.py
        â”œâ”€â”€ api_config.py
        â””â”€â”€ app_config.py
```

### å‰ç«¯æ¶æ„

```
frontend/
â”œâ”€â”€ css/
â”‚   â””â”€â”€ styles.css          # æ‰€æœ‰æ ·å¼
â”œâ”€â”€ js/
â”‚   â””â”€â”€ app.js              # æ‰€æœ‰è„šæœ¬
â””â”€â”€ index.html              # HTMLç»“æ„
```

## ğŸ”§ é…ç½®è¯´æ˜

### 1. æ•°æ®åº“é…ç½®
ä½ç½®ï¼š`backend/infrastructure/config/database_config.py`

### 2. å¤–éƒ¨APIé…ç½®
ä½ç½®ï¼š`backend/infrastructure/config/api_config.py`
```python
EXTERNAL_API_CONFIG = {
    'url': 'https://apiprod.mtygs.cn/api/stock/getStockAnalysis',
    'token': 'ä½ çš„token',
    'timeout': 15
}
```

### 3. åº”ç”¨é…ç½®
ä½ç½®ï¼š`backend/infrastructure/config/app_config.py`
- æœåŠ¡å™¨é…ç½®
- å‘¨æœŸç±»å‹æ˜ å°„
- æ—¶é—´èŒƒå›´é…ç½®

## ğŸ“ APIæ¥å£è¯´æ˜

### 1. è·å–è‚¡ç¥¨åˆ†ç»„
```
GET /api/stock_groups
```

### 2. è·å–å¯ç”¨å‘¨æœŸ
```
POST /api/available_periods
Body: {
  "table_name": "basic_data_sz300188"
}
```

### 3. è·å–Kçº¿æ•°æ®
```
POST /api/kline_data
Body: {
  "table_name": "basic_data_sz300188",
  "period_type": "day"
}
```

### 4. è·å–è‚¡ç¥¨åˆ†æ
```
POST /api/stock_analysis
Body: {
  "stock_code": "SZ300188"
}
```

## ğŸ¨ å‰ç«¯åŠŸèƒ½

1. **ç­–ç•¥é€‰æ‹©**ï¼šæ³¢æ®µã€çŸ­çº¿ã€ä¸­é•¿çº¿
2. **è‚¡ç¥¨æœç´¢**ï¼šæ”¯æŒåç§°å’Œä»£ç æœç´¢
3. **å‘¨æœŸåˆ‡æ¢**ï¼š30åˆ†é’Ÿã€æ—¥Kã€å‘¨Kã€æœˆK
4. **Kçº¿å›¾è¡¨**ï¼šä½¿ç”¨EChartså±•ç¤º
5. **åˆ†ææ•°æ®**ï¼šç›ŠæŸæ¯”ã€æ”¯æ’‘çº¿ã€å‹åŠ›çº¿

## ğŸ“š æ ¸å¿ƒæ–‡ä»¶è¯´æ˜

### åç«¯å…¥å£
- `backend/app.py` - ä¸»åº”ç”¨ï¼ˆå·²æ›´æ–°ä¸ºDDDæ¶æ„ï¼‰
- `backend/app.py.old` - æ—§ç‰ˆæœ¬å¤‡ä»½

### å‰ç«¯æ–‡ä»¶
- `frontend/index.html` - HTMLç»“æ„ï¼ˆå·²æ›´æ–°ä¸ºåˆ†ç¦»ç‰ˆï¼‰
- `frontend/index.html.old` - æ—§ç‰ˆæœ¬å¤‡ä»½
- `frontend/css/styles.css` - æ ·å¼æ–‡ä»¶ï¼ˆæ–°ï¼‰
- `frontend/js/app.js` - è„šæœ¬æ–‡ä»¶ï¼ˆæ–°ï¼‰

## ğŸ”„ ç‰ˆæœ¬å›æ»š

å¦‚éœ€å›æ»šåˆ°æ—§ç‰ˆæœ¬ï¼š

```powershell
# å›æ»šåç«¯
cd backend
Copy-Item app.py.old app.py -Force

# å›æ»šå‰ç«¯
cd ../frontend
Copy-Item index.html.old index.html -Force
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **é¦–æ¬¡è¿è¡Œ**ï¼šç¡®ä¿æ•°æ®åº“å·²åˆ›å»ºå¹¶å¯¼å…¥æ•°æ®
2. **ç«¯å£å ç”¨**ï¼šé»˜è®¤ä½¿ç”¨5000ç«¯å£ï¼Œå¦‚è¢«å ç”¨éœ€ä¿®æ”¹é…ç½®
3. **æ•°æ®åº“è¿æ¥**ï¼šç¡®ä¿MySQLæœåŠ¡å·²å¯åŠ¨
4. **å¤–éƒ¨API**ï¼šåˆ†æåŠŸèƒ½ä¾èµ–å¤–éƒ¨APIï¼Œå¯èƒ½æœ‰è¶…æ—¶

## ğŸ†˜ å¸¸è§é—®é¢˜

### 1. å¯¼å…¥é”™è¯¯
```
ModuleNotFoundError: No module named 'xxx'
```
è§£å†³ï¼šè¿è¡Œ `pip install -r requirements.txt`

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
```
pymysql.err.OperationalError: (2003, "Can't connect...")
```
è§£å†³ï¼šæ£€æŸ¥MySQLæœåŠ¡æ˜¯å¦å¯åŠ¨ï¼Œé…ç½®æ˜¯å¦æ­£ç¡®

### 3. ç«¯å£å·²è¢«å ç”¨
```
OSError: [WinError 10048]
```
è§£å†³ï¼šä¿®æ”¹`backend/infrastructure/config/app_config.py`ä¸­çš„ç«¯å£

## ğŸ“– æ›´å¤šæ–‡æ¡£

- **æ¶æ„è¯¦è§£**ï¼š`backend/README_DDD.md`
- **é‡æ„è¯´æ˜**ï¼š`DDDæ¶æ„é‡æ„å®Œæˆè¯´æ˜.md`

## âœ… éªŒè¯å®‰è£…

å¯åŠ¨åè®¿é—® http://localhost:5000 ï¼Œåº”è¯¥çœ‹åˆ°ï¼š
1. ç³»ç»ŸçŠ¶æ€æ˜¾ç¤º"ç³»ç»Ÿè¿è¡Œæ­£å¸¸"
2. å¯ä»¥é€‰æ‹©ç­–ç•¥ç±»å‹
3. å¯ä»¥é€‰æ‹©è‚¡ç¥¨
4. å¯ä»¥æŸ¥çœ‹Kçº¿å›¾è¡¨

## ğŸ‰ å®Œæˆ

ç°åœ¨æ‚¨å¯ä»¥å¼€å§‹ä½¿ç”¨æ–°çš„DDDæ¶æ„ç³»ç»Ÿäº†ï¼

æœ‰ä»»ä½•é—®é¢˜è¯·æŸ¥çœ‹ç›¸å…³æ–‡æ¡£æˆ–è”ç³»å¼€å‘è€…ã€‚

