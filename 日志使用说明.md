# 日志使用说明

## 📝 日志功能

系统已集成完整的日志记录功能，所有操作都会被记录到本地日志文件中。

## 📂 日志文件位置

所有日志文件存储在项目根目录的 `logs/` 文件夹中：

```
alpha_strategy_v2/
└── logs/
    ├── app.log          # 应用主日志
    ├── api.log          # API请求日志
    ├── database.log     # 数据库操作日志
    └── external_api.log # 外部API调用日志
```

## 📊 日志文件说明

### 1. app.log - 应用主日志
记录系统启动、关闭和主要流程信息。

**内容包括：**
- 系统启动信息
- 服务器配置
- 应用级别的错误和警告

**示例：**
```
2025-11-07 15:30:00 - app - INFO - ==================================================
2025-11-07 15:30:00 - app - INFO - 阿尔法策略2.0系统启动
2025-11-07 15:30:00 - app - INFO - 服务器地址: 0.0.0.0:5000
2025-11-07 15:30:00 - app - INFO - 调试模式: True
2025-11-07 15:30:00 - app - INFO - ==================================================
```

### 2. api.log - API请求日志
记录所有API接口的请求和响应。

**内容包括：**
- API请求信息（端点、参数）
- 处理结果（成功/失败）
- 响应数据统计
- 错误信息和堆栈跟踪

**示例：**
```
2025-11-07 15:30:15 - api - INFO - 收到请求: 获取股票分组信息
2025-11-07 15:30:15 - api - INFO - 成功返回股票分组，共3个分组
2025-11-07 15:30:20 - api - INFO - 收到请求: 获取K线数据, 表名=basic_data_sz300188, 周期=day
2025-11-07 15:30:21 - api - INFO - 成功返回K线数据，共730条记录
```

### 3. database.log - 数据库日志
记录所有数据库操作。

**内容包括：**
- 数据库连接状态
- 查询执行信息
- 事务处理
- 连接池状态
- 数据库错误

**示例：**
```
2025-11-07 15:30:20 - database - DEBUG - 正在连接数据库: localhost:3306/stock
2025-11-07 15:30:20 - database - DEBUG - 数据库连接成功
2025-11-07 15:30:21 - database - DEBUG - 数据库连接已关闭
```

### 4. external_api.log - 外部API日志
记录所有外部API调用。

**内容包括：**
- API调用请求
- 响应状态
- 数据解析
- 超时和错误
- 重试记录

**示例：**
```
2025-11-07 15:30:25 - external_api - INFO - 调用外部API: 获取股票分析, 股票代码=SZ300188
2025-11-07 15:30:26 - external_api - INFO - 外部API响应: 股票 SZ300188, success=True, status=200
2025-11-07 15:30:26 - external_api - INFO - 成功获取股票分析数据: SZ300188
```

## 🔍 如何查看日志

### Windows

#### 方法1：使用记事本
```bash
notepad logs\app.log
```

#### 方法2：使用PowerShell实时查看
```powershell
# 查看最后50行
Get-Content logs\app.log -Tail 50

# 实时监控日志（类似tail -f）
Get-Content logs\app.log -Wait -Tail 10
```

#### 方法3：使用VS Code
```bash
code logs\app.log
```

### Linux/Mac

#### 查看日志
```bash
# 查看完整日志
cat logs/app.log

# 查看最后50行
tail -n 50 logs/app.log

# 实时监控日志
tail -f logs/app.log

# 查看并搜索关键字
grep "ERROR" logs/app.log

# 查看多个日志文件
tail -f logs/*.log
```

## 📈 日志级别

系统使用以下日志级别（从低到高）：

1. **DEBUG** - 调试信息（详细的执行流程）
2. **INFO** - 一般信息（正常的操作记录）
3. **WARNING** - 警告信息（潜在问题）
4. **ERROR** - 错误信息（功能异常）
5. **CRITICAL** - 严重错误（系统级故障）

## 🎯 常见用途

### 1. 查看系统启动是否正常
```bash
Get-Content logs\app.log -Tail 20
```

### 2. 查看API调用情况
```bash
Get-Content logs\api.log -Tail 50
```

### 3. 查找错误信息
```bash
# PowerShell
Select-String -Path logs\*.log -Pattern "ERROR"

# Linux/Mac
grep -r "ERROR" logs/
```

### 4. 查看某个时间段的日志
```bash
# PowerShell
Get-Content logs\app.log | Select-String "2025-11-07 15:"

# Linux/Mac
grep "2025-11-07 15:" logs/app.log
```

### 5. 实时监控系统运行
```bash
# PowerShell
Get-Content logs\app.log -Wait -Tail 10

# Linux/Mac
tail -f logs/app.log
```

## 🔧 日志配置

### 日志轮转
- 每个日志文件最大 10MB
- 自动轮转，保留5个备份文件
- 旧文件命名：`app.log.1`, `app.log.2` ...

### 修改日志级别
编辑 `backend/infrastructure/logging/logger.py`：

```python
# 将 INFO 改为 DEBUG 可以看到更详细的日志
logger = LoggerManager.setup_logger('app', log_file, logging.DEBUG)
```

### 自定义日志位置
编辑 `backend/infrastructure/logging/logger.py` 中的 `log_dir` 变量：

```python
log_dir = os.path.join(os.path.dirname(__file__), '..', '..', '..', 'logs')
```

## 📋 日志分析示例

### 查看今天的错误
```powershell
$today = Get-Date -Format "yyyy-MM-dd"
Select-String -Path logs\*.log -Pattern "$today.*ERROR"
```

### 统计API调用次数
```powershell
(Select-String -Path logs\api.log -Pattern "收到请求").Count
```

### 查看最慢的查询
```powershell
Select-String -Path logs\database.log -Pattern "查询执行时间"
```

## 🚨 注意事项

1. **日志文件会占用磁盘空间**
   - 建议定期清理旧日志
   - 日志会自动轮转，不会无限增长

2. **生产环境建议**
   - 将日志级别设为 INFO 或 WARNING
   - DEBUG 日志会产生大量信息

3. **性能影响**
   - 日志记录对性能影响很小
   - 使用异步日志可以进一步提升性能

4. **隐私保护**
   - 日志中可能包含敏感信息
   - 不要将日志文件提交到Git仓库

## 🛠️ 故障排查

### 问题：看不到日志文件
**解决：** 
1. 检查 `logs/` 目录是否存在
2. 运行一次应用自动创建日志目录

### 问题：日志文件太大
**解决：**
1. 日志会自动轮转，无需担心
2. 可以手动删除旧的备份文件（.1, .2 等）

### 问题：需要更详细的日志
**解决：**
修改日志级别为 DEBUG：
```python
logger = LoggerManager.setup_logger('app', log_file, logging.DEBUG)
```

## 📚 更多信息

- Python logging 官方文档: https://docs.python.org/3/library/logging.html
- 日志最佳实践: https://docs.python.org/3/howto/logging.html

---

**现在你可以实时查看系统运行日志了！** 🎉

